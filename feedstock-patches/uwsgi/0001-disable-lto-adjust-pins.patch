From 3efe8a373f207b18c3bcacb79b4b7c64036d7707 Mon Sep 17 00:00:00 2001
From: Nishidha Panpaliya <npanpa23@in.ibm.com>
Date: Wed, 4 Aug 2021 08:50:44 +0000
Subject: [PATCH] Some opence changes

---
 config/conda_build_config.yaml |  5 +++++
 recipe/build.sh                |  2 +-
 recipe/meta.yaml               | 12 +++++++++---
 3 files changed, 15 insertions(+), 4 deletions(-)
 create mode 100644 config/conda_build_config.yaml

diff --git a/config/conda_build_config.yaml b/config/conda_build_config.yaml
new file mode 100644
index 0000000..d9c5e20
--- /dev/null
+++ b/config/conda_build_config.yaml
@@ -0,0 +1,5 @@
+c_compiler_version:
+  - 8
+cxx_compiler_version:
+  - 8
+
diff --git a/recipe/build.sh b/recipe/build.sh
index cc88e64..aa719f1 100644
--- a/recipe/build.sh
+++ b/recipe/build.sh
@@ -3,7 +3,7 @@ export UWSGI_INCLUDES="${PREFIX}/include,${PREFIX}/include/openssl"
 export LDFLAGS="-L${PREFIX}/lib ${LDFLAGS}"
 
 if [[ $(uname) == Linux ]]; then
-  export LDFLAGS="${LDFLAGS} -Wl,--no-as-needed"
+  export LDFLAGS="${LDFLAGS} -fno-lto -Wl,--no-as-needed"
 fi
 
 UWSGI_EMBED_PLUGINS=stats_pusher_statsd ${PYTHON} -m pip install . --no-deps -vv
diff --git a/recipe/meta.yaml b/recipe/meta.yaml
index cf36a13..3016dc1 100644
--- a/recipe/meta.yaml
+++ b/recipe/meta.yaml
@@ -18,17 +18,23 @@ requirements:
   build:
     - {{ compiler('c') }}
     - {{ compiler('cxx') }}
+    # Use pins to control cos6/cos7 match
+    - libgcc-ng  {{ libgcc }}
+    - libstdcxx-ng  {{ libstdcxx }}
   host:
     - icu
     - jansson
     - libpython-static  # [py>=38]
     - libxml2  # [not win]
     - openssl
-    - pcre
+    - pcre 8.44
     - pip
-    - python
+    - python {{ python }}
     - yaml
-    - zlib
+    - zlib {{zlib }}
+    # Use pins to control cos6/cos7 match
+    - libgcc-ng  {{ libgcc }}
+    - libstdcxx-ng  {{ libstdcxx }}
   run:
     - jansson
     - python
-- 
2.23.0

