name: Open-CE Unit Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 2
      - uses: conda-incubator/setup-miniconda@v2.0.0
        with:
          auto-update-conda: true
          python-version: 3.8
      - name: Install dependencies
        shell: bash -l {0}
        run: |
          conda install -y pylint=2.7
          pip install yamllint==1.24.2
      - name: Lint all test files for warnings and errors only
        shell: bash -l {0}
        run: |
          PYTHONPATH=./open_ce/:./tests/:${PYTHONPATH} \
                  pylint \
                    --disable=R,C,protected-access \
                    ./tests/*.py \
                    ./tests/**/*.py
      - name: Lint config files
        shell: bash -l {0}
        run: |
          # Use yamllint to check the actual yaml files.
          yamllint .github/actions/*/*.yml .github/workflows/*.yml
