From 3e1922f10a90b692b8cd9c233f006330cea9f931 Mon Sep 17 00:00:00 2001
From: Deepali Chourasia <deepch23@in.ibm.com>
Date: Wed, 15 Mar 2023 06:10:36 +0000
Subject: [PATCH] Open-CE changes

---
 recipe/build.sh  |  2 +-
 recipe/meta.yaml | 13 ++++++++-----
 2 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/recipe/build.sh b/recipe/build.sh
index cc88e64..aa719f1 100644
--- a/recipe/build.sh
+++ b/recipe/build.sh
@@ -3,7 +3,7 @@ export UWSGI_INCLUDES="${PREFIX}/include,${PREFIX}/include/openssl"
 export LDFLAGS="-L${PREFIX}/lib ${LDFLAGS}"
 
 if [[ $(uname) == Linux ]]; then
-  export LDFLAGS="${LDFLAGS} -Wl,--no-as-needed"
+  export LDFLAGS="${LDFLAGS} -fno-lto -Wl,--no-as-needed"
 fi
 
 UWSGI_EMBED_PLUGINS=stats_pusher_statsd ${PYTHON} -m pip install . --no-deps -vv
diff --git a/recipe/meta.yaml b/recipe/meta.yaml
index aef49e9..88c454b 100644
--- a/recipe/meta.yaml
+++ b/recipe/meta.yaml
@@ -13,25 +13,28 @@ build:
   number: 0
   skip: True  # [win]
   detect_binary_files_with_prefix: true
+  ignore_run_exports:
+    - libxml2
 
 requirements:
   build:
-    - {{ compiler('c') }}
-    - {{ compiler('cxx') }}
+    - {{ compiler('c') }}        # [ppc_arch != "p10"]
+    - {{ compiler('cxx') }}      # [ppc_arch != "p10"]
   host:
     - icu
     - jansson
     - libpython-static  # [py>=38]
     - libxml2  # [not win]
     - openssl
-    - pcre
+    - pcre 8.44
     - pip
-    - python
+    - python {{ python }}
     - yaml
-    - zlib
+    - zlib {{ zlib }}
   run:
     - jansson
     - python
+    - libxml2 >=2.9.14,<2.11.0a0
 
 test:
   source_files:
-- 
2.34.1

