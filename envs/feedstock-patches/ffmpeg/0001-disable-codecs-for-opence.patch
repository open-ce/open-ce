From 9501c16fc56452d7cf617f3e74ce62de2ecb0428 Mon Sep 17 00:00:00 2001
From: Deepali Chourasia <deepch23@in.ibm.com>
Date: Tue, 9 May 2023 08:10:04 +0000
Subject: [PATCH] disable codecs for opence

---
 recipe/build.sh  | 20 ++++++++++++++++++--
 recipe/meta.yaml |  8 +-------
 2 files changed, 19 insertions(+), 9 deletions(-)

diff --git a/recipe/build.sh b/recipe/build.sh
index 8528472..f035552 100755
--- a/recipe/build.sh
+++ b/recipe/build.sh
@@ -26,9 +26,9 @@ else
   # https://github.com/openssl/openssl/commit/151333164ece49fdba3fe5c4bbdc3333cd9ae66d
   _CONFIG_OPTS+=("--disable-openssl")
   # The Cisco GPL-compliant wrapper (you need to get your own binaries for this)
-  _CONFIG_OPTS+=("--enable-libopenh264")
+  _CONFIG_OPTS+=("--disable-libopenh264")
   # GPL-3.0
-  _CONFIG_OPTS+=("--enable-libx264")
+  _CONFIG_OPTS+=("--disable-libx264")
 fi
 
 ./configure \
@@ -50,6 +50,22 @@ fi
         --enable-version3 \
         --enable-zlib \
       	--enable-libmp3lame \
+        --disable-encoder=h264 \
+        --disable-decoder=h264 \
+        --disable-decoder=libh264 \
+        --disable-decoder=libx264 \
+        --disable-decoder=libopenh264 \
+        --disable-encoder=libopenh264 \
+        --disable-encoder=libx264 \
+        --disable-decoder=libx264rgb \
+        --disable-encoder=libx264rgb \
+        --disable-encoder=hevc \
+        --disable-decoder=hevc \
+        --disable-encoder=aac \
+        --disable-decoder=aac \
+        --disable-decoder=aac_fixed \
+        --disable-encoder=aac_latm \
+        --disable-decoder=aac_latm \
         "${_CONFIG_OPTS[@]}"
 
 make -j${CPU_COUNT} ${VERBOSE_AT}
diff --git a/recipe/meta.yaml b/recipe/meta.yaml
index 23ad810..f3578d0 100644
--- a/recipe/meta.yaml
+++ b/recipe/meta.yaml
@@ -28,7 +28,7 @@ requirements:
   build:
     - {{ compiler("c") }}
     - {{ compiler("cxx") }}
-    - pkg-config  # [not win]
+    - pkg-config {{ pkgconfig }}
     - libtool  # [not win]
     - nasm  # [(osx and x86_64) or linux32 or linux64]
     - make  # [not win]
@@ -37,9 +37,7 @@ requirements:
     - freetype  # [not win]
     - gnutls  # [not win]
     - libiconv  # [not win and not linux]
-    - x264  # [not win]
     - zlib  # [not win]
-    - openh264  # [not win]
     - lame  # [not win]
     - gmp  # [unix]
     - libvpx  # [not win]
@@ -55,10 +53,6 @@ test:
     - ffmpeg -loglevel panic -protocols | grep "https"  # [not win]
     - ffmpeg -loglevel panic -codecs | grep "libmp3lame"  # [not win]
     - ffmpeg -loglevel panic -codecs | grep "DEVI.S zlib"  # [unix]
-    - ffmpeg -loglevel panic -codecs | grep "DEV.LS h264"  # [linux64 or osx64]
-    - ffmpeg -loglevel panic -codecs | grep "D.V.LS h264"  # [ppc64le]
-    - ffmpeg -loglevel panic -codecs | grep "libx264"  # [linux64 or osx64]
-    - ffmpeg -loglevel panic -codecs | grep "libopenh264"  # [linux64 or osx64]
     # Verify dynamic libraries on all systems
     {% set ffmpeg_libs = [
         "avcodec",
-- 
2.34.1

