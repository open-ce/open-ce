From aac962e7387ba35f5942895f4ca274f7c9328275 Mon Sep 17 00:00:00 2001
From: Deepali Chourasia <deepch23@in.ibm.com>
Date: Fri, 6 Oct 2023 09:43:31 +0000
Subject: [PATCH] Update to v41.0.4

---
 recipe/meta.yaml | 30 ++++++++++++++++--------------
 1 file changed, 16 insertions(+), 14 deletions(-)

diff --git a/recipe/meta.yaml b/recipe/meta.yaml
index 4e20d73..10b6c5d 100644
--- a/recipe/meta.yaml
+++ b/recipe/meta.yaml
@@ -1,4 +1,4 @@
-{% set version = "41.0.3" %}
+{% set version = "41.0.4" %}
 
 package:
   name: cryptography
@@ -6,17 +6,18 @@ package:
 
 source:
   url: https://pypi.io/packages/source/c/cryptography/cryptography-{{ version }}.tar.gz
-  sha256: 6d192741113ef5e30d89dcb5b956ef4e1578f304708701b8b73d38e3e1461f34
+  sha256: 7febc3094125fc126a7f6fb1f420d0da639f3f32cb15c8ff0dc3997c4549f51a
 
 build:
   number: 0
   skip: true  # [py<37 or win32]
+  string: opence_py{{ python | replace(".", "") }}_h{{ PKG_HASH }}_{{ PKG_BUILDNUM }}
   # linux-ppc64le failing test phase on all 1.1.1 builds skipping until 1.1.1 is dropped completely
   # for more info on error: https://anaconda.atlassian.net/browse/PKG-2252
   # This can be dropped after OpenSSL 1.1.1 support is dropped in Sept 2023
-  {% if ARCH == "ppc64le" and (openssl | string).startswith('1.1.1') %}
-  skip: true
-  {% endif %}
+#  {% if ARCH == "ppc64le" and (openssl | string).startswith('1.1.1') %}
+#  skip: true
+#  {% endif %}
   script:
   # As of cryptography version 40.0.0, build instructions have changed: https://cryptography.io/en/latest/changelog/#v40-0-0
   # here is the documentation on setting things manually, https://docs.rs/openssl/latest/openssl/#manual
@@ -28,20 +29,21 @@ build:
 requirements:
   build:
     - {{ compiler('rust') }}
-    - vs2017_{{ target_platform }}    # [win]
-
+    - {{ compiler('c') }}
   host:
-    - python
-    - pip
-    - setuptools >=61.0.0
-    - setuptools-rust >=0.11.4
+    - python {{ python }}
+    - pip {{ pip }}
+    - setuptools {{ setuptools }}
+    - setuptools-rust {{ setuptools_rust }}
     - wheel
-    - openssl {{openssl}}
+    - openssl            #[s390x]
+    - openssl 1.1.1zz    #[not s390x]
     - cffi 1.15.1
   run:
-    - python
+    - python {{ python }}
     - cffi >=1.12
-    - openssl
+    - openssl            #[s390x]
+    - openssl 1.1.1zz    #[not s390x]
     - libgcc-ng     # [linux]; needed by `_rust.abi3.so`
 
 test:
-- 
2.40.1

